<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Scooter</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <!-- PyScript CDN -->
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
</head>
<body>
    <h1>ðŸ›´ School Scooter</h1>
    <div id="tutorial-overlay" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(255,255,255,0.97);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:1000;">
        <h2 style="font-size:2em;color:#1976d2;">Welcome to School Scooter!</h2>
        <p style="font-size:1.2em;">Use <b>WASD</b> or <b>Arrow Keys</b> to move.<br>Collect coins, avoid obstacles, and have fun!</p>
        <button id="startBtn" style="font-size:1.1em;padding:0.5em 1.5em;">Start Game</button>
    </div>
    <div id="game-container">
        <div style="display: flex; flex-direction: row; align-items: flex-start;">
            <!-- Hallway map -->
            <div id="hallway">
                <!-- Player character stays centered at bottom -->
                <div id="player" style="left: 200px; top: 230px;"></div>
                <!-- Moving elements will be generated by JS -->
            </div>
            <!-- Geek panel on the right -->
            <div id="geek-console" style="display:none; min-width: 220px; margin-left: 24px; background: #e8f5e9; border: 1px solid #81c784; border-radius: 8px; padding: 1em; font-size: 1em;">
                <h2>Stuff for Geeks</h2>
                <div><b>Speed:</b> <span id="geek-speed">20</span> px/move</div>
                <div><b>Score:</b> <span id="geek-score">0</span></div>
                <div><b>Collisions:</b> <span id="geek-collisions">0</span></div>
                <button id="pauseBtn" style="margin-top:1em;">Pause Game</button>
                <div style="margin-top:1em; font-size:0.95em; color:#388e3c;">
                    <b>Code Explanation:</b> <br>
                    Player movement and collision logic are handled in JavaScript. <br>
                    Use WASD or arrow keys to move. Colliding with obstacles triggers a cutscene.
                </div>
            </div>
        </div>
    </div>
    <div id="instructions" style="max-width: 500px; margin: 2em auto; background: #fffbe6; border: 1px solid #ffe58f; border-radius: 8px; padding: 1em; font-size: 1.1em;">
        <h2>How to Play</h2>
        <ul>
            <li>Use <b>Arrow Keys</b> to move your scooter left, right, up, and down.</li>
            <li>Try to avoid obstacles and collect coins!</li>
            <li>More features coming soon...</li>
        </ul>
    </div>
    <button id="toggle-geek" style="margin: 1em auto; display: block; font-size: 1em;">Show Stuff for Geeks</button>
    <div id="scoreboard" style="max-width: 500px; margin: 2em auto; background: #e3f2fd; border: 1px solid #90caf9; border-radius: 8px; padding: 1em; font-size: 1.2em; text-align: center;">
        <strong>Score:</strong> <span id="score">0</span>
    </div>
    <script>
    // Continuous/dynamic obstacle and coin generation
    const hallway = document.getElementById('hallway');
    let speed = 2;
    function spawnElement(type) {
        const el = document.createElement('div');
        el.className = type;
        el.style.position = 'absolute';
        el.style.left = Math.floor(Math.random() * 400) + 'px';
        el.style.top = '-40px';
        hallway.appendChild(el);
    }

    // Dynamic spawn rate and difficulty scaling
    let spawnInterval = 1000;
    let spawnTimer;
    function startSpawning() {
        if (spawnTimer) clearInterval(spawnTimer);
        spawnTimer = setInterval(function() {
            if (!gameOver && !paused) {
                // Increase chance of obstacles as score increases
                let obstacleChance = Math.min(0.6 + score * 0.01, 0.9);
                let coinChance = Math.max(0.5 - score * 0.005, 0.2);
                if (Math.random() < obstacleChance) { spawnElement('obstacle'); }
                if (Math.random() < coinChance) { spawnElement('coin'); }
            }
        }, spawnInterval);
    }
    startSpawning();

    // Move obstacles and coins downward
    function moveElements() {
        document.querySelectorAll('.obstacle, .coin').forEach(function(el) {
            let top = parseInt(el.style.top);
            top += speed;
            el.style.top = top + 'px';
            // Remove if out of hallway
            if (top > 280) { el.remove(); }
        });
    }

    setInterval(function() {
        if (!gameOver && !paused) { moveElements(); }
    }, 30);
    // Tutorial overlay logic
    document.getElementById('startBtn').onclick = () => {
        document.getElementById('tutorial-overlay').style.display = 'none';
    };
    // School Scooter: Game Controls, Coin & Obstacle Collision, Teacher Cutscene, Geek Console
    const player = document.getElementById('player');
    let pos = { x: 200, y: 230 };
    const step = 40;
    let score = 0;
    let gameOver = false;
    let collisions = 0;
    let paused = false;

    function getRect(el) {
        return el.getBoundingClientRect();
    }

    function checkCoinCollision() {
        const playerRect = getRect(player);
        document.querySelectorAll('.coin').forEach(coin => {
            const coinRect = getRect(coin);
            if (
                playerRect.left < coinRect.right &&
                playerRect.right > coinRect.left &&
                playerRect.top < coinRect.bottom &&
                playerRect.bottom > coinRect.top
            ) {
                coin.remove();
                score += 1;
                step += 2;
                speed += 0.2;
                updateScore();
                updateGeekStats();
            }
        });
    }

    function checkObstacleCollision() {
        const playerRect = getRect(player);
        let hit = false;
        document.querySelectorAll('.obstacle').forEach(obstacle => {
            const obsRect = getRect(obstacle);
            if (
                playerRect.left < obsRect.right &&
                playerRect.right > obsRect.left &&
                playerRect.top < obsRect.bottom &&
                playerRect.bottom > obsRect.top
            ) {
                hit = true;
            }
        });
        return hit;
    }

    function updateScore() {
        document.getElementById('score').textContent = score;
    }

    function updateGeekStats() {
        document.getElementById('geek-speed').textContent = step;
        document.getElementById('geek-score').textContent = score;
        document.getElementById('geek-collisions').textContent = collisions;
    }

    function movePlayer(e) {
        if (gameOver || paused) return;
        switch (e.key) {
            case 'ArrowLeft':
            case 'a':
            case 'A':
                pos.x = Math.max(0, pos.x - step);
                break;
            case 'ArrowRight':
            case 'd':
            case 'D':
                pos.x = Math.min(400, pos.x + step);
                break;
        }
        player.style.left = `${pos.x}px`;
        player.style.top = `230px`;
        checkCoinCollision();
        if (checkObstacleCollision()) {
            gameOver = true;
            collisions++;
            updateGeekStats();
            showTeacherCutscene();
        }
    }
    document.addEventListener('keydown', movePlayer);

    function showTeacherCutscene() {
        const cutscene = document.createElement('div');
        cutscene.id = 'cutscene';
        cutscene.style.position = 'fixed';
        cutscene.style.top = '0';
        cutscene.style.left = '0';
        cutscene.style.width = '100vw';
        cutscene.style.height = '100vh';
        cutscene.style.background = 'rgba(255,255,255,0.95)';
        cutscene.style.display = 'flex';
        cutscene.style.flexDirection = 'column';
        cutscene.style.alignItems = 'center';
        cutscene.style.justifyContent = 'center';
        cutscene.style.zIndex = '999';
        cutscene.innerHTML = `
            <h1 style="color:#d32f2f;font-size:2.5em;">ðŸš¨ Teacher Caught You!</h1>
            <p style="font-size:1.3em;">Yelling cutscene: "Hey! No scooters in the hallway!"</p>
            <button id="restartBtn" style="font-size:1.1em;padding:0.5em 1.5em;">Restart</button>
        `;
        document.body.appendChild(cutscene);
        document.getElementById('restartBtn').onclick = () => {
            cutscene.remove();
            pos = { x: 200, y: 230 };
            player.style.left = `${pos.x}px`;
            player.style.top = `230px`;
            score = 0;
            updateScore();
            document.querySelectorAll('.coin').forEach(coin => coin.style.display = '');
            gameOver = false;
            updateGeekStats();
        };
    }

    // Geek console toggle and pause
    document.getElementById('toggle-geek').onclick = () => {
        const geek = document.getElementById('geek-console');
        geek.style.display = geek.style.display === 'none' ? 'block' : 'none';
        updateGeekStats();
    };
    document.getElementById('pauseBtn').onclick = () => {
        paused = !paused;
        document.getElementById('pauseBtn').textContent = paused ? 'Resume Game' : 'Pause Game';
    };
    </script>
<!-- ...existing code... -->

print("Hello from PyScript!")
    </py-script>
</body>
</html>